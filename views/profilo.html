<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
        GestGenSuite
    </title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- CSS Files -->
    <link href="assets/css/material-dashboard.css?v=2.1.0" rel="stylesheet" />
</head>

<body class="">
<div class="wrapper ">
    <div class="sidebar" data-color="purple" data-background-color="white">
        <!--
          Tip 1: You can change the color of the sidebar using: data-color="purple | azure | green | orange | danger"

          Tip 2: you can also add an image using data-image tag
      -->
        <div class="logo">
            <a class="simple-text logo-normal">
            GestGenSuite <img src="images/logo.png" height="100px" >
        </a>

        </div>
        <div class="sidebar-wrapper">
            <ul class="nav">
                <li class="nav-item ">
                    <a class="nav-link" href="/dashboard">
                        <i class="material-icons">dashboard</i>
                        <p>Dashboard</p>
                    </a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="/profilo">
                        <i class="material-icons">person</i>
                        <p>Profilo</p>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/utenti">
                        <i class="material-icons">content_paste</i>
                        <p>Tabella Utenti</p>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/clienti">
                        <i class="material-icons">library_books</i>
                        <p>Tabella Clienti</p>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/inserimento">
                        <i class="material-icons">border_color</i>
                        <p>Inserimento</p>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/saldo">
                        <i class="material-icons">attach_money</i>
                        <p>Saldo</p>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/prodotti">
                        <i class="material-icons">restaurant_menu</i>
                        <p>Prodotti</p>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/fornitori">
                        <i class="material-icons">transfer_within_a_station</i>
                        <p>Tabella Fornitori</p>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/logout">
                        <i class="material-icons">exit_to_app</i>
                        <p>Logout</p>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="main-panel">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
            <div class="container-fluid">
                <div class="navbar-wrapper">
                    <a class="navbar-brand" href="/profilo">Profilo</a>
                </div>
                <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="navbar-toggler-icon icon-bar"></span>
                    <span class="navbar-toggler-icon icon-bar"></span>
                    <span class="navbar-toggler-icon icon-bar"></span>
                </button>
                <div class="collapse navbar-collapse justify-content-end">

                </div>
            </div>
        </nav>
        <!-- End Navbar -->
        <div class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header card-header-primary">
                                <h4 class="card-title">Modifica Profilo</h4>
                                <p class="card-category">Completa il tuo profilo</p>
                            </div>
                            <div class="card-body">
                                <form id="utenteForm">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Username</label>
                                                <input id="username" type="text" class="form-control" required>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Password</label>
                                                <input id="password" type="text" class="form-control" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Nome</label>
                                                <input id="nome" type="text" class="form-control" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Cognome</label>
                                                <input id="cognome" type="text" class="form-control" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Struttura</label>
                                                <input id="struttura" type="text" class="form-control" disabled="true">
                                            </div>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary pull-right">Aggiorna Profilo</button>
                                    <div class="clearfix"></div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card card-profile">
                            <div class="card-avatar">
                                <a href="#pablo">
                                    <img class="img" src="../assets/img/faces/avatar.png" />
                                </a>
                            </div>
                            <div class="card-body">
                                <h6 class="card-category text-gray">Amministratore di struttura</h6>
                                <h4 id="titolo" class="card-title"></h4>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header card-header-primary">
                                <h4 class="card-title">Modifica Struttura</h4>
                                <p class="card-category">Completa la tua struttura</p>
                            </div>
                            <div class="card-body">
                                <form id="strutturaForm">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Nome</label>
                                                <input id="nomeStruttura" type="text" class="form-control" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Indirizzo</label>
                                                <input id="indirizzo" type="text" class="form-control" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Recapito</label>
                                                <input id="recapito" type="text" class="form-control" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">Logo</span>
                                                </div>
                                                <div class="custom-file">
                                                    <input type="file" class="custom-file-input" id="inp">
                                                    <label class="custom-file-label" for="inp">Scegli File</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="bmd-label-floating">Anteprima</label>
                                                <img id="img" height="150">
                                            </div>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary pull-right">Aggiorna Struttura</button>
                                    <div class="clearfix"></div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card card-profile">
                            <div class="card-avatar">
                                <a href="#pablo">
                                    <img class="img" src="../assets/img/faces/build.png" />
                                </a>
                            </div>
                            <div class="card-body">
                                <h6 class="card-category text-gray">Struttura Assegnata</h6>
                                <h4 id="titoloStruttura" class="card-title"></h4>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal fade" id="myModal1">
                    <div class="modal-dialog modal-sm">
                        <div class="modal-content">
                            <!-- dialog body-->
                            <div class="modal-body">
                                <button class="close" type="button" data-dismiss="modal">×</button>
                                <h3>Errore nell'aggiornamento!</h3>
                            </div>
                            <!-- dialog buttons-->
                            <div class="modal-footer"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <div class="container-fluid">
                <div class="copyright float-right">
                    &copy;
                    <script>
                        document.write(new Date().getFullYear())
                    </script>, powered by
                    <a href="http://www.ak12srl.it" target="_blank">Ak-12 S.r.l.</a>
                </div>
                <!-- your footer here -->
            </div>
        </footer>
    </div>
</div>
<!--   Core JS Files   -->
<script src="assets/js/core/jquery.min.js" type="text/javascript"></script>
<script src="assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="assets/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
<script src="assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
<!-- Chartist JS -->
<script src="assets/js/plugins/chartist.min.js"></script>
<!--  Notifications Plugin    -->
<script src="assets/js/plugins/bootstrap-notify.js"></script>
<!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
<script src="assets/js/material-dashboard.min.js?v=2.1.0" type="text/javascript"></script>
</body>

<script>

    $( document ).ready(function() {

        function readFile() {

            if (this.files && this.files[0]) {

                var FR= new FileReader();

                FR.addEventListener("load", function(e) {
                    document.getElementById("img").src       = e.target.result;
                    document.getElementById("b64").innerHTML = e.target.result;
                });

                FR.readAsDataURL( this.files[0] );
            }

        }

        document.getElementById("inp").addEventListener("change", readFile);

        $.ajax({
            url: '/getAdmin',
            type: 'GET',
            cache: false,
            contentType: 'application/json',
            success: function(data) {

                if(data.errore===false){

                    $('#username').val(data.user.username);
                    $('#password').val(data.user.password);
                    $('#nome').val(data.user.nome);
                    $('#cognome').val(data.user.cognome);

                    $('#titolo').text(data.user.nome + " " + data.user.cognome);

                    $.ajax({
                        url: '/getStrutturaWeb',
                        type: 'GET',
                        cache: false,
                        contentType: 'application/json',
                        success: function(data) {

                            if(data.errore===false){

                                $('#struttura').val(data.struttura.nome);
                                $('#nomeStruttura').val(data.struttura.nome);
                                $('#indirizzo').val(data.struttura.indirizzo);
                                $('#recapito').val(data.struttura.recapito);
                                $('#titoloStruttura').text(data.struttura.nome);
                                $('#img').attr("src",data.struttura.img);




                            }
                            else if(data.errore===true){



                            }

                        },
                        faliure: function(data) {

                        }
                    });

                }
                else if(data.errore===true){



                }

            },
            faliure: function(data) {

            }
        });

    });


    $('#utenteForm').on("submit", function(){

        let datiAdmin = {
            "username": $('#username').val(),
            "password": $('#password').val(),
            "nome": $('#nome').val(),
            "cognome": $('#cognome').val()
        };

        $.ajax({
            url: '/getAdmin',
            type: 'PUT',
            data: JSON.stringify(datiAdmin),
            cache: false,
            contentType: 'application/json',
            success: function(data) {

                if(data===true){

                    $("#myModal1").on("show", function () {
                        $("#myModal1 a.btn").on("click", function (e) {
                            console.log("button pressed");
                            $("#myModal1").modal('hide');
                        });
                    });
                    $("#myModal1").on("hide", function () {
                        $("#myModal1 a.btn").off("click");
                    });

                    $("#myModal1").on("hidden", function () {
                        $("#myModal1").remove();
                    });

                    $("#myModal1").modal({
                        "backdrop": "static",
                        "keyboard": true,
                        "show": true
                    });

                }

                else if(data===false){


                    window.location.reload();


                }

            },
            faliure: function(data) {

            }
        });


        return false;
    });

    $('#strutturaForm').on("submit", function(){

        let datiStruttura = {
            "nomeStruttura": $('#nomeStruttura').val(),
            "indirizzo": $('#indirizzo').val() ,
            "recapito": $('#recapito').val(),
            "text": $('#img').attr("src")
        };

        $.ajax({
            url: '/getStrutturaWeb',
            type: 'PUT',
            data: JSON.stringify(datiStruttura),
            cache: false,
            contentType: 'application/json',
            success: function(data) {

                if(data===true){

                    $("#myModal1").on("show", function () {
                        $("#myModal1 a.btn").on("click", function (e) {
                            console.log("button pressed");
                            $("#myModal1").modal('hide');
                        });
                    });
                    $("#myModal1").on("hide", function () {
                        $("#myModal1 a.btn").off("click");
                    });

                    $("#myModal1").on("hidden", function () {
                        $("#myModal1").remove();
                    });

                    $("#myModal1").modal({
                        "backdrop": "static",
                        "keyboard": true,
                        "show": true
                    });

                }

                else if(data===false){

                    window.location.reload();

                }

            },
            faliure: function(data) {

            }
        });


        return false;
    });

</script>

</html>